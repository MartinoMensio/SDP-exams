# Theory part 22/07/2013

## Point 1

### Question

(3.0 marks) How is organized the list of free blocks in a Unix filesystem? What is the funciton of an index block in the Unix filesystem, what happens to an index block when all the data it contains have been used?

### Solution

TODO

## Point 2

### Question

(3.0 marks) Explain the meaning of the following command line, detailing the function of each argument

`qemu -serial mon:stdio -hda fs.img xv6.img -smp 2 -m 512 -S -gdb tcp::2600`

### Solution

TODO

## Point 3

### Question

(2.0 marks) Explain, within the framework of win32 events, the difference between *pulse* and *set* behaviour. How is it possible to implement a semaphore using a counter variable and an event? Describe the kind of event used, and how the two semaphore operations can be implemented *(code is allowed but not required)*.

### Solution

TODO

## Point 4

### Question

(3.0 marks) Which are the roles of file pointers and of the overlapped structures in direct file access on WIN32 systems? Briefly describe common aspects and differences. The prototype of function `ReadFile` is:

```c
BOOL ReadFile (HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped)
```

How can we handle pointers to large files? What is a LARGE_INTEGER type in Win32? How can we increment a LARGE_INTEGER variable by 1? Given a file of size 40 GB, containing records of fixed size 256 Bytes, how can we read record n. 2^27 (records are numbered starting from 0)?

Provide the solution with file pointers and with overlapped structure.

### Solution

TODO

## Point 5

### Question

(4.0 marks) In the following code section, `se` is a global semaphore and `TraverseAndSaveList` is a thread function.

```c
HANDLE se;
static void TraverseAndSaveList (LPTSTR fullPath, LPTSTR dirName, HANDLE fileHandle);
```

`TraverseAndSaveList` **recursively** visits the directory named `dirName` and it stores **all** encountered entry names in the file referenced by `fileHandle`.

The variable `fullPath` represents the full file system path to `dirName`. If, for instance, the target directory is `a/b/c`, `fullPath` is `a/b` and `dirName` is `c`.

As `TraverseAndSaveList` is a thread (concurrent) function, each write operation on the `fileHandle` file has to be propery synchronized threugh the `se` semaphore.

The format of the file `fileHandle` is free.

Write function `TraverseAndSaveList` to perform the requested operations.

### Solution

TODO
